<style>
/* Language switcher button in toolbar */
.book .book-header .btn.js-toolbar-action.lang-switcher-btn {
    display: inline-block;
}

.lang-switcher-dropdown {
    position: absolute;
    top: 50px;
    right: 10px;
    background: white;
    border: 1px solid #ccc;
    border-radius: 3px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    display: none;
    z-index: 1000;
    min-width: 120px;
}

.lang-switcher-dropdown.active {
    display: block;
}

.lang-option {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
    transition: background 0.2s;
}

.lang-option:last-child {
    border-bottom: none;
}

.lang-option:hover {
    background: #f5f5f5;
}

.lang-option.selected {
    background: #e8f4fd;
    color: #4183c4;
    font-weight: 600;
}

/* Theme-specific styles */
.book.color-theme-1 .lang-switcher-dropdown {
    background: #111111;
    border-color: #7e888b;
}

.book.color-theme-1 .lang-option {
    color: #afa790;
    border-color: #7e888b;
}

.book.color-theme-1 .lang-option:hover {
    background: #1a1a1a;
}

.book.color-theme-1 .lang-option.selected {
    background: #2a2a2a;
    color: #704214;
}

.book.color-theme-2 .lang-switcher-dropdown {
    background: #2d3143;
    border-color: #272a3a;
}

.book.color-theme-2 .lang-option {
    color: #c1c6d7;
    border-color: #272a3a;
}

.book.color-theme-2 .lang-option:hover {
    background: #252737;
}

.book.color-theme-2 .lang-option.selected {
    background: #373b4e;
    color: #f4f4f5;
}
</style>

<script>
require(['gitbook', 'jquery'], function(gitbook, $) {
    let currentLang = localStorage.getItem('preferredLang') || 'ko';
    
    function filterPostsByLanguage(lang) {
        $('.chapter[data-lang]').each(function() {
            const postLang = $(this).attr('data-lang');
            if (postLang === lang || !postLang) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    }
    
    function updateDropdownSelection() {
        $('.lang-option').removeClass('selected');
        $('.lang-option[data-lang="' + currentLang + '"]').addClass('selected');
    }
    
    gitbook.events.bind('start', function(e, config) {
        // Add language switcher button to toolbar
        gitbook.toolbar.createButton({
            icon: 'fa fa-globe',
            label: 'Language',
            position: 'left',
            onClick: function(e) {
                e.preventDefault();
                $('.lang-switcher-dropdown').toggleClass('active');
            }
        });
        
        // Add dropdown menu to body
        setTimeout(function() {
            if ($('.lang-switcher-dropdown').length === 0) {
                const dropdown = $('<div class="lang-switcher-dropdown">' +
                    '<div class="lang-option" data-lang="ko">ðŸ‡°ðŸ‡· í•œêµ­ì–´</div>' +
                    '<div class="lang-option" data-lang="en">ðŸ‡ºðŸ‡¸ English</div>' +
                    '</div>');
                
                $('.book-header').append(dropdown);
                
                // Add click handlers for language options
                $('.lang-option').on('click', function() {
                    currentLang = $(this).attr('data-lang');
                    localStorage.setItem('preferredLang', currentLang);
                    updateDropdownSelection();
                    filterPostsByLanguage(currentLang);
                    $('.lang-switcher-dropdown').removeClass('active');
                });
                
                updateDropdownSelection();
            }
        }, 100);
        
        // Close dropdown when clicking outside
        $(document).on('click', function(e) {
            if (!$(e.target).closest('.lang-switcher-btn, .lang-switcher-dropdown').length) {
                $('.lang-switcher-dropdown').removeClass('active');
            }
        });
    });
    
    gitbook.events.bind('page.change', function() {
        filterPostsByLanguage(currentLang);
        updateDropdownSelection();
    });
});
</script>
